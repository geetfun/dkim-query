#!/usr/bin/env ruby

require 'dkim_parse'

unless ARGV[0]
  puts "Please supply at least one host name"
  exit
end

ARGV.each do |arg|
  puts "____________________________\n"
  puts "DKIM record search for #{arg}"

  domain = DKIMParse::Domain.query(arg)

  unless domain.keys.empty?
    puts "- found DKIM record for #{arg}"

    domain.keys.each do |selector,key|
      puts "  #{selector}:"

      [:v, :g, :h, :k, :n, :p, :s, :t].each do |field|
        value = key.send(field)
        puts "    #{field}: #{value}" if value
      end
    end
  else
    puts "- no DKIM record found for #{arg}"
  end
  puts "____________________________\n\n"
end
